    location / {
        # Try to serve the file, then directory, then fallback to index.html for SPA routing
        try_files $uri $uri/ /index.html;
    }

    # Forbidden access to hidden files and build artifacts
    location ~ ^/(\.user.ini|\.htaccess|\.git|\.env|\.svn|\.project|\.vscode|\.idea|node_modules|package\.json|package-lock\.json|\.npmrc|\.gitignore)
    {
        return 404;
    }

    # Favicon handling
    location = /favicon.ico {
        access_log off;
        log_not_found off;
        expires 7d;
    }

    # Image files with cache
    location ~* \.(png|jpg|jpeg|gif|webp|svg|ico|bmp|avif)$ {
        expires 30d;
        access_log off;
        log_not_found off;
        add_header Cache-Control "public, immutable";
    }

    # CSS and JavaScript files (VitePress assets usually have hash in filename)
    location ~* \.(js|css|mjs)$ {
        expires 1y;
        access_log off;
        log_not_found off;
        add_header Cache-Control "public, immutable";
        
        # Enable compression for JS/CSS
        gzip on;
        gzip_vary on;
        gzip_types text/css application/javascript application/json;
    }

    # Font files
    location ~* \.(woff|woff2|ttf|eot|otf)$ {
        expires 1y;
        access_log off;
        log_not_found off;
        add_header Cache-Control "public, immutable";
        add_header Access-Control-Allow-Origin "*";
    }

    # HTML files - short cache for content updates
    location ~* \.html$ {
        expires 1h;
        add_header Cache-Control "public, must-revalidate";
    }

    # JSON and XML files (feeds, sitemaps, etc.)
    location ~* \.(json|xml)$ {
        expires 1d;
        add_header Cache-Control "public";
    }

    # robots.txt and sitemap
    location = /robots.txt {
        allow all;
        log_not_found off;
        access_log off;
        expires 1d;
    }

    location = /sitemap.xml {
        allow all;
        log_not_found off;
        access_log off;
        expires 1d;
    }

    # Deny access to source maps in production (optional)
    location ~* \.map$ {
        # Uncomment to deny access
        # deny all;
        # return 404;
        
        # Or allow with no cache
        expires -1;
        add_header Cache-Control "no-store, no-cache, must-revalidate";
    }

    # Deny access to sensitive files
    location ~* \.(?:git|env|log|sh|sql|conf|bak|swp|old|tmp|md)$ { 
        deny all;
        return 404;
    }

    # Security headers
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header Referrer-Policy "no-referrer-when-downgrade" always;
