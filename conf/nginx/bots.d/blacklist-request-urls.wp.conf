map $request_uri $block_wp_url {
    default 0;

    # ================================
    # 0. WordPress敏感路径
    # ================================
    "~*^/xmlrpc\.php" 1;
    "~*^/wp-json/" 1;

    # ================================
    # 1. 探测 PHP 木马 / 后门 / 探针
    # ================================
    "~*^/phpinfo\.php$" 1;
    "~*^/info\.php$" 1;
    "~*^/test\.php$" 1;
    "~*^/php\.php$" 1;
    "~*^/dashboard/phpinfo\.php$" 1;
    "~*^/tool/view/phpinfo\.view\.php$" 1;

    # 泛型 PHP 探针（扫描常见后门名）
    "~*^/(php|test|info)\.php$" 1;

    # Laravel / custom / CMS 后门探针
    "~*^/autoload_classmap\.php$" 1;
    "~*^/uploaded_script\.php$" 1;
    "~*^/worksec\.php$" 1;
    "~*^/about\.php$" 1;

    # ================================
    # 2. WP 恶意插件扫描（木马路径）
    # ================================
    "~*^/wp-content/plugins/.*/up\.php$" 1;
    "~*^/wp-content/plugins/(pwnd|pwnd-1|simple)/.*$" 1;
    "~*^/wp-content/worksec\.php$" 1;

    # ================================
    # 3. 错误/异常路径的 WP 扫描
    # ================================
    "~*^/wp-admin/maint/.*\.php$" 1;
    "~*^/wp-content/(cache|languages|themes|upgrade)/index\.php$" 1;
    "~*^/wordpress/.*" 1;

    # ================================
    # 4. 日志文件探针攻击（非常常见）
    # ================================
    "~*^/error\.log$" 1;
    "~*^/access\.log$" 1;
    "~*^/debug\.log$" 1;
    "~*^/logs/error\.log$" 1;
    "~*^/logs/access\.log$" 1;
    "~*^/logs/debug\.log$" 1;
    "~*^/storage/logs/laravel\.log$" 1;
    "~*^/wp-content/debug\.log$" 1;

    # ================================
    # 5. .env 探针（必须拦截）
    # ================================
    "~*\.env$" 1;
    "~*^/.*\.env$" 1;
    "~*^/(api|dev|admin|laravel)/\.env$" 1;
    "~*^/(sendgrid|twilio)\.env$" 1;

    # ================================
    # 6. 双斜线绕过攻击
    # ================================
    "~*^//xmlrpc\.php" 1;
}
